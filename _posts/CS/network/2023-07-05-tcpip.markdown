# 2. TCP/IP 4계층 모델
---
layout: post
title: TCP/IP 4계층 모델
subtitle: TCP/IP 4계층 별 설명과 OSI 7계층과 비교
categories: [네트워크]
---
<aside>
💡 보완이 필요한 페이지입니다.

</aside>

인터넷 프로토콜 스위트는 인터넷에서 컴퓨터들이 서로 정보를 주고받는 데 쓰이는 프로토콜 집합이며 이를 OSI 7계층이나 TCP/IP 4계층으로 설명합니다. ISO 표준은 OSI 7계층이지만 4계층이 이해하기 더 쉬워 많이 쓰인다.

# 1. 계층 구조

TCP/IP 계층은 네 개의 계층을 가지고 있으며 OSI 7계층과 많이 비교한다.

<p algin="center"><img class="img-fluid" src="/assets/img/Network/OSI_TCP/OSIvsTCP.png" alt="OSI vs TCP/IP" /></p>
<span class="caption text-muted">좌: OSI 7 계층 / 우: TCP/IP 4계층</span>

## 1.1. 응용 계층

응용프로그램이 사용되는 프로토콜 계층이며 웹 서비스, 이메일 등 서비스를 실질적으로 사람들에게 제공하는 층

## 1.2. 전송 계층

송신자와 수신자를 연결하는 통신 서비스를 제공하며 연결 지향 데이터 스트림 지원, 신뢰성, 흐름 제어를 제공할 수 있다. 애플리케이션과 인터넷 계층 사이의 데이터가 전달될 때 중계 역할을 한다.

대표적으로 TCP, UDP가 있다. TCP는 가상회선 패킷 교환 방식을 사용한 신뢰성 있는 프로토콜이고 UDP는 데이터그램 패킷 교환 방식을 사용한 비신뢰성에 빠른 프로토콜이다.

### 1.2.1. 가상회선 패킷 교환 방식

각 패킷에는 가상회선 식별자가 포함되며 모든 패킷을 전송하면 가상회선이 해제되고 패킷들은 전송된 순서대로 도착하는 방식, 경로 선택은 경로를 설정할 때 한 번만 수행한다.

<p algin="center"><img class="img-fluid" src="/assets/img/Network/OSI_TCP/Untitled.png" alt="가상회선 패킷 교환 방식" /></p>
<span class="caption text-muted">가상회선 패킷 교환 방식</span>

### 1.2.2. 데이터 그램 패킷 교환 방식

패킷이 독립적으로 이동하며 최적의 경로를 선택하여 간다. 하나의 메시지에서 분할된 여러 패킷은 서로 다른 경로로 전송될 수 있으며 도착한 순서가 다를 수 있는 방식이다. 패킷들은 라우터마다 경로가 지정된다.

<p algin="center"><img class="img-fluid" src="/assets/img/Network/OSI_TCP/Untitled1.png" alt="데이터그램 패킷 교환 방식" /></p>
<span class="caption text-muted">데이터그램 패킷 교환 방식</span>

### 1.2.3. TCP 연결

UDP는 아래의 handshake 과정이 신뢰성 없는 계층이라 불린다.

**성립 과정 (3-way-hankshake)**

<p algin="center"><img class="img-fluid" src="/assets/img/Network/OSI_TCP/Untitled2.png" alt="3-way-handshake" /></p>
<span class="caption text-muted">3-way-handshake</span>

1. SYN 단계: 클라이언트는 서버에 클라이언트의 ISN을 담아 SYN을 보낸다. ISN은 새로운 TCP 연결의 첫 번째 패킷에 할당된 임의의 시퀀스 번호를 말한다.
2. SYN + ACK 단계: 서버는 클라이언트의 SYN을 수신하고 서버의 ISN을 보내며 승인번호로 클라이언트의 ISN + 1을 보냅니다.
3. ACK 단계: 클라이언트는 서버의 ISN + 1한 값인 승인번호를 담아 ACK를 서버에 보낸다.

**해제 과정(4-way-hankshake)**

<p algin="center"><img class="img-fluid" src="/assets/img/Network/OSI_TCP/Untitled3.png" alt="4-way-handshake" /></p>
<span class="caption text-muted">4-way-handshake</span>

1. 연결을 닫으려는 클라이언트가 FIN 세그먼트를 보낸다. 클라이언트는 FIN-WAIT-1 상태에 들어간다.
2. 서버는 클라이언트로 ACK라는 승인 세그먼트를 보낸다. 그 후 CLOSE_WAIT 상태에 들어간다.
3. 서버는 ACK를 보내고 일정 시간 이후에 클라이언트에 FIN이라는 세그먼트를 보낸다.
4. 클라이언트는 TIME_WAIT 상태가 되고 다시 서버로 ACK를 보내서 서버는 CLOSED 상태가 된다. 이후 클라이언트는 어느 정도의 시간을 대기 후 연결이 닫히고 클라이언트와 서버의 모든 자원의 연결이 해제된다.

TIME_WAIT이 존재하는 이유는 아래의 두 가지이다.

1. 지연 패킷 존재
2. 두 장치의 연결이 닫혔는지 확인

## 1.3. 인터넷 계층

인터넷 계층은 장치로부터 받은 네트워크 패킷을 IP 주소로 지정된 목적지로 전송하기 위해 사용되는 계층이다. 상대방이 받았는지에 대해 보장하지 않는 비연결형적 특징을 가지고 있다. 

## 1. 4. 링크 계층

전선, 광섬유, 무선 등으로 실질적으로 데이터를 전달하며 장치 간에 신호를 주고받는 규칙을 정하는 계층이다. OSI 7계층에서는 물리와 데이터링크 이렇게 두 가지 계층으로 나눈다. 물리 계층은 비트 데이터를 보내는 계층이고 데이터 링크 계층은 에러 확인, 흐름 제어, 접근 제어를 담당하는 계층이다.

### 1.4.1. 물리 계층

### 1.4.1.1. 유선 LAN(IEEE802.3)

**1) 전이중화 통신**

전이중화(full duplex) 통신은 양쪽 장치가 동시에 송수신할 수 있는 방식을 말한다. 이는 송신로와 수신로로 나눠서 데이터를 주고받으며 현대의 고속 이더넷은 이 방식을 기반으로 통신한다. 4선식 전송로로 구성하거나 2선식 전송로에서 멀티플렉싱을 통해 4선식처럼 구성한 선로를 사용한다.

**2) CSMA/CD**

반이중화 통신 중 하나다. 데이터를 보낸 후 충돌이 발생하면 일정 시간 이후 재전송하는 방식이다. 경로가 전이중화 통신처럼 2선식 내지는 3선식 구성이 아니기 때문에 이런 방식을 채택했었다.

### 1.4.1.2. 무선 LAN(IEEE802.11)

무선 LAN 장치는 수신과 송신에 같은 채널을 사용하기 때문에 반이중화 통신을 사용한다.

**1) 반이중화 통신**

반이중화(half duplex) 통신은 양쪽 장치가 서로 통신은 하지만 동시에는 할 수 없으며 한 번에 한 방향만 통신하는 방식을 말한다. 신호를 수신하기 시작하면 응당하기 전에 전송이 완료될 때까지 기다려야 한다. 또 충돌이 발생하면 메시지가 손실될 수 있기 때문에 충돌 방지 시스템이 필요하다.

**2) CSMA/CA**

반이중화 통신 중 하나로 장치에서 데이터를 보내기 전에 캐리어 감지 등으로 사전에 가능한 충돌을 방지하는 방식을 사용하며 과정은 다음과 같이 이루어진다.

1. 데이터를 송신하기 전에 무선 매체를 살핀다.
2. 캐리어 감지: 회선이 비어있는지 판단한다.
3. IFS: 랜덤값을 기반으로 정해진 시간만큼 기다리며, 만약 무선 매체가 사용 중이면 점차 그 간격을 늘려가며 기다린다.
4. 데이터 송신

### 1.4.2. 데이터링크 계층

### 1.4.2.1. 이더넷 프레임

이더넷 프레임을 통해 전달받은 데이터의 에러를 검출하고 캡슐화하며 다음과 같은 구조를 가진다. 

<p algin="center"><img class="img-fluid" src="/assets/img/Network/OSI_TCP/Untitled4.png" alt="프레임 구조" /></p>
<span class="caption text-muted">프레임 구조</span>

Preamble: 이더넷 프레임이 시작임을 알린다.

SFD: 다음 바이트부터 MAC 주소 필드가 시작됨을 알린다.

DMAC, SMAC: 수신, 송신 MAC 주소를 말한다.

EtherType: 데이터 계층 위의 계층인 IP 프로토콜을 정의합니다. (IPv4, IPv6)

Payload: 전달받은 데이터

CRC: 에러 확인 비트

# 2. 계층간 데이터 송수신 과정

## 2.1. PDU

계층 간 데이터가 전달될 때 한 덩어리의 단위를 PDU라 부른다. PDU는 제어 관련 정보들이 포함된 ‘헤더’, 데이터를 의미하는 ‘페이로드’로 구성되어 있으며 각 계층 이름이 존재한다.

### 캡슐화 과정

데이터를 다른 컴퓨터로 전송하면 애플리케이션 → 전송 → 인터넷 → 링크 순서로 캡슐화를 하고 링크 → 인터넷 → 전송 → 애플리케이션 순서로 비캡슐화를 진행한다.

캡슐화 과정은 상위 계층의 헤더와 데이터를 하위 계층의 데이터 부분에 포함하고 해당 계층의 헤더를 삽입하는 과정을 말한다. 비캡슐화는 이의 역순으로 진행한다.

<p algin="center"><img class="img-fluid" src="/assets/img/Network/OSI_TCP/PDU.png" alt="OSI 7계층 캡슐화 과정과 PDU" /></p>
<span class="caption text-muted">OSI 7계층 캡슐화 과정과 PDU</span>

OSI 7계층 캡슐화단계와 PDU

>###### 참고자료

>###### 면접을 위한 CS 전공지식 노트 by 주홍철